rules:
  - id: function_exists
    languages:
      - php
    message: This file is checking if dangerous functions exist
    metadata:
      description: Identify when a user is checking for dangerous functions
    patterns:
      - pattern-either:
          - pattern: function_exists($FUNC)
          - pattern: |
              function $F1(...) {
                ... function_exists(...); ...
              }
              ...
              function $F2(...)
              {if($F1($FUNC)){...}}
      - metavariable-regex:
          metavariable: $FUNC
          regex: .*('|"")?(exec|passthru|shell_exec|shellexec|system|mysql_connect|mssql_connect|pg_connect|bzcompress|gzcompress|gzencode|posix_getuid|posix_uname|ocilogon)('|"")?.*
    severity: WARNING