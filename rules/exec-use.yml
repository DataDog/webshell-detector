rules:
  - id: exec-use
    languages:
      - php
    message: This file is running dangerous executive commands
    metadata:
      description: Identify when dangerous executive commands are run
      tags: HIGH
    patterns:
      - pattern-either:
          - pattern: exec($CMD)
          - pattern: shell_exec($CMD)
          - pattern: pcntl_exec($CMD)
          - pattern: system($CMD)
          - pattern: passthru($CMD)
          - pattern: assert($CMD)
      - metavariable-regex:
          metavariable: $CMD
          regex: .*('|")?.*(pwd|id|whoami|cd|ls|cmd|cmnd|cfe|uname|rm|cat|mv|netstat|ps|ifconfig|wget|curl).*('|")?.*
    severity: WARNING